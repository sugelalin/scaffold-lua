
upstream localhost-upstream {
	server 127.0.0.1:8901;
	server 127.0.0.1:8902 backup;
	server 127.0.0.1:8903 max_fails=10 fail_timeout=10s backup;
}

server {
    listen       8900;
    access_log   logs/server-access.log monitor;
    error_log    logs/server-error.log debug;

	location = /status {
        access_log off;
        allow 127.0.0.1;
        #deny all;

        default_type text/plain;
        content_by_lua_block {
            local hc = require "resty.upstream.healthcheck"
            ngx.say("Nginx Worker PID: ", ngx.worker.pid())
            ngx.print(hc.status_page())
        }
    }
}